<html>
<head>
<title>PegaPop</title>
<script id="facebook-jssdk" src="http://connect.facebook.net/en_US/all.js"></script>
<script type="text/javascript" src="http://webplayer.unity3d.com/download_webplayer-3.x/3.0/uo/UnityObject.js"></script>
<script>
errorMsg = 'Desculem-nos, algo deu errado, por favor tente denovo recarregando a p√°gina! Obrigado.';
var userFunc = function() { alert(errorMsg); }
var friendFunc = function() { alert(errorMsg); }
var publishScore = function() { alert(errorMsg); }
var fbStatus = "not_connected";

function GetUser() {
	userFunc();
}

function GetFriends() {
	friendFunc();
}

function PostScore(score) {
	publishScore(score);
}

</script>

		<style type="text/css">
		<!--
		body {
			font-family: Helvetica, Verdana, Arial, sans-serif;
			background-color: white;
			color: black;
			text-align: center;
		}
		a:link, a:visited {
			color: #000;
		}
		a:active, a:hover {
			color: #666;
		}
		p.header {
			font-size: small;
		}
		p.header span {
			font-weight: bold;
		}
		p.footer {
			font-size: x-small;
		}
		div.content {
			margin: auto;
			width: 960px;
		}
		div.missing {
			margin: auto;
			position: relative;
			top: 50%;
			width: 193px;
		}
		div.missing a {
			height: 63px;
			position: relative;
			top: -31px;
		}
		div.missing img {
			border-width: 0px;
		}
		div#unityPlayer {
			cursor: default;
			height: 600px;
			width: 960px;
		}
		-->
		</style>
</head>

<body>
<div id="fb-root"></div> <!-- Required by Facebook -->
<script type='text/javascript'>
 
    //Fired when the facebook sdk has loaded
    window.fbAsyncInit = function()
    {
	//alert('fbAsyncInit');
	publishScore = function(score)
	{
		var body = 'Acabei de fazer - ' + score + ' pontos no PegaPop ';

		FB.api('/me/feed', 'post', {
			link: 'http://www.seedframework.org/', 
			message: body, 
			name: 'PegaPop',
			caption: 'PegaPop Testando', 
			description: 'Venha jogar o PegaPop comigo', 
			picture: 'http://www.seedframework.org/image.png'
		}, function(response) 
		{
			//alert('foi');
			if (!response || response.error) 
			{
			//	getUnity().SendMessage("FacebookManager", "OnPostError");
			}
			else
			{
				getUnity().SendMessage("FacebookManager", "OnPostComplete", response.id);
		//		FB.api('/' + response.id + '/likes', 'post', {}, function(response) {});
			}
		});
	}
 
        userFunc = function() //When we are logged in this shows our name.
        {
            FB.api('/me', function(meResponse)  //Do a graph request to /me
            {
                var fbdata = meResponse.id + "," + meResponse.first_name; //As per our format, 'id,name;'
                getUnity().SendMessage("FacebookManager", "OnUserComplete", fbdata); 
            });
        }
 
        friendFunc = function()
        {
            FB.api('/me/friends', function(friendResponse)
            {
                var fbdata;
                for(var i = 0; i < friendResponse.data.length; i++) //Loop over all my friends
                    fbdata += friendResponse.data[i].id + "," + friendResponse.data[i].name + ';';
                getUnity().SendMessage("FacebookManager", "OnFriendsComplete", fbdata);
            });
        }
       
	FB.init(
        {
          appId      : '464856483572343',
          status     : true, // check login status
          cookie     : true, // enable cookies to allow the server to access the session
          oauth      : true, // enable OAuth 2.0
          xfbml      : false // dont parse XFBML
        });

	FB.Event.subscribe('auth.statusChange', function(response) {
  		fbStatus = response.status;
	}); 
 
        //Log the user in when the page loads.
        FB.getLoginStatus(function(loginStatusResponse)
        {
            if (loginStatusResponse.authResponse) //There is an authresponse, the user is already logged in and authenticated
            {
		 userFunc();
            } 
	    else 
	    {
		//The user was not logged in, allow him to.
                FB.login(function(loginResponse)
                {
                    if (loginResponse.authRespsonse) //Did he login successfully?
                    {
			userFunc();
                    }
                }, {scope: 'publish_stream'});
            }

	    //PostScore(12121);
        });
    };
 
    //Load the Facebook JS SDK
   /* (function(d) {
     var js, id = 'facebook-jssdk';
     if (d.getElementById(id)) { return;}
     js = d.createElement('script');
     js.id = id;
     js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     d.getElementsByTagName('head')[0].appendChild(js);
    } (document) );
 */
    function getUnity() //Default unity functions
    {
        if (typeof unityObject != "undefined")
        {
            return unityObject.getObjectById("unityPlayer");
        }
        return null;
    }
    if (typeof unityObject != "undefined")
    {
        unityObject.embedUnity("unityPlayer", "web.unity3d?http://www.seedframework.org/", 960, 600); //  http://pegapop.comercial.ws/cadastro/ranking/
    }
 
 
</script>

<p class="header">
<div class="content">
	<div id="unityPlayer">
		<div class="missing">
			<a href="http://unity3d.com/webplayer/" title="Unity Web Player. Install now!">
				<img alt="Unity Web Player. Install now!" src="http://webplayer.unity3d.com/installation/getunity.png" width="193" height="63" />
			</a>
		</div>
	</div>
</div>
</p>

</body>
</html>
